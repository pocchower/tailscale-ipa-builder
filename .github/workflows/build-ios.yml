name: Build IPA on GitHub macOS Runner

on:
  workflow_dispatch:

jobs:
  build-ios:
    runs-on: macos-13

    steps:
      - name: "Main Checkout source code"
        uses: actions/checkout@v4

      - name: "Main Set up Go"
        uses: actions/setup-go@v4
        with:
          go-version: '1.23.8'

      - name: "Prepare gomobile and bind to XCFramework (Real macOS only)"
        if: runner.os == 'macOS'
        run: |
          go install golang.org/x/mobile/cmd/gomobile@latest
          gomobile init
          gomobile bind -target=ios -o ./build_output/Mobile.xcframework ./path/to/your/package

      - name: "⚠️ Fallback: Simulate gomobile on Linux"
        if: runner.os != 'macOS'
        run: |
          echo "⚠️  Linux runner detected - simulating gomobile output"
          mkdir -p build_output/Mobile.xcframework/ios-arm64
          echo "Simulated Mobile.framework" > build_output/Mobile.xcframework/ios-arm64/Mobile.framework
          echo "Mock Info.plist" > build_output/Mobile.xcframework/ios-arm64/Info.plist

      - name: "🧪 Simulate iOS Packaging"
        if: runner.os != 'macOS'
        run: |
          mkdir -p build_output
          echo "FAKE IPA GENERATED UNDER LINUX" > build_output/App.ipa

      - name: "📦 Upload Artifact (.ipa)"
        uses: actions/upload-artifact@v4
        with:
          name: ios-artifact
          path: build_output/App.ipa

